--// SERVICES
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local SoundService = game:GetService("SoundService")

--// VARIABLES
local localPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera
local camLockEnabled = false
local camLockKey = Enum.KeyCode.Q
local smoothness = 0.1
local targetPlayer = nil
local predictionAmount = Vector3.new(0.05, 0, 0.05)
local legitMode = false
local waitingForKey = false

--// GUI SETUP
local gui = Instance.new("ScreenGui", localPlayer:WaitForChild("PlayerGui"))
gui.Name = "SaltyCamlock"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true

-- Sounds
local function createSound(id)
	local sound = Instance.new("Sound")
	sound.SoundId = "rbxassetid://" .. id
	sound.Volume = 1
	sound.Parent = gui
	return sound
end

local clickSound = createSound("12221967")
local toggleSound = createSound("413279809")
local sparkleSound = createSound("9118823103")
sparkleSound:Play()

-- Main Frame
local frame = Instance.new("Frame", gui)
frame.AnchorPoint = Vector2.new(0.5, 0.5)
frame.Position = UDim2.new(0.5, 0, 0.5, 0)
frame.Size = UDim2.new(0, 300, 0, 280)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.BackgroundTransparency = 0.1
frame.Active = true
frame.Draggable = true

Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)
local stroke = Instance.new("UIStroke", frame)
stroke.Color = Color3.fromRGB(255, 255, 255)
stroke.Transparency = 0.15
stroke.Thickness = 2

local pad = Instance.new("UIPadding", frame)
pad.PaddingTop = UDim.new(0, 10)
pad.PaddingLeft = UDim.new(0, 10)
pad.PaddingRight = UDim.new(0, 10)

-- Title
local title = Instance.new("TextLabel", frame)
title.Text = "Salty ^-^ Camlock"
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.GothamBold
title.TextSize = 20
title.TextXAlignment = Enum.TextXAlignment.Left

-- Button Template
local function createButton(text, yPos)
	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(1, -20, 0, 32)
	btn.Position = UDim2.new(0, 10, 0, yPos)
	btn.Text = text
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 16
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	btn.AutoButtonColor = false
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)

	local stroke = Instance.new("UIStroke", btn)
	stroke.Color = Color3.fromRGB(255, 255, 255)
	stroke.Transparency = 0.7

	btn.MouseEnter:Connect(function()
		btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
	end)
	btn.MouseLeave:Connect(function()
		btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	end)

	return btn
end

-- Buttons
local toggleBtn = createButton("Toggle Camlock (OFF)", 40)
local legitBtn = createButton("Toggle Legit Mode (OFF)", 80)
local keybindLabel = Instance.new("TextLabel", frame)
keybindLabel.Position = UDim2.new(0, 10, 0, 120)
keybindLabel.Size = UDim2.new(1, -20, 0, 20)
keybindLabel.Text = "Keybind: Q"
keybindLabel.Font = Enum.Font.Gotham
keybindLabel.TextSize = 14
keybindLabel.TextColor3 = Color3.new(1, 1, 1)
keybindLabel.BackgroundTransparency = 1

local keyBtn = createButton("Click to change key", 145)
keyBtn.Size = UDim2.new(1, -20, 0, 25)

-- Smoothness
local smoothLabel = Instance.new("TextLabel", frame)
smoothLabel.Text = "Smoothness: 0.1"
smoothLabel.Position = UDim2.new(0, 10, 0, 180)
smoothLabel.Size = UDim2.new(1, -20, 0, 20)
smoothLabel.Font = Enum.Font.Gotham
smoothLabel.TextSize = 14
smoothLabel.TextColor3 = Color3.new(1, 1, 1)
smoothLabel.BackgroundTransparency = 1

local smoothSlider = Instance.new("TextButton", frame)
smoothSlider.Position = UDim2.new(0, 10, 0, 205)
smoothSlider.Size = UDim2.new(1, -20, 0, 10)
smoothSlider.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
smoothSlider.Text = ""
smoothSlider.AutoButtonColor = false
Instance.new("UICorner", smoothSlider).CornerRadius = UDim.new(0, 6)

local fill = Instance.new("Frame", smoothSlider)
fill.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
fill.Size = UDim2.new(smoothness, 0, 1, 0)
fill.BorderSizePixel = 0
Instance.new("UICorner", fill).CornerRadius = UDim.new(0, 6)

-- Closest Player
local function getClosestPlayer()
	local shortest, closest = math.huge, nil
	local myChar = localPlayer.Character
	if not myChar or not myChar:FindFirstChild("HumanoidRootPart") then return end
	local myPos = myChar.HumanoidRootPart.Position
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local dist = (player.Character.HumanoidRootPart.Position - myPos).Magnitude
			if dist < shortest then
				shortest = dist
				closest = player
			end
		end
	end
	return closest
end

-- Highlight
local highlight = Instance.new("Highlight")
highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
highlight.FillColor = Color3.new(1, 1, 1)
highlight.OutlineColor = Color3.new(0, 0, 0)
highlight.FillTransparency = 0.7
highlight.OutlineTransparency = 0.3
highlight.Parent = gui

-- Toggle Camlock
local function toggleCamlock()
	toggleSound:Play()
	camLockEnabled = not camLockEnabled
	toggleBtn.Text = "Toggle Camlock (" .. (camLockEnabled and "ON" or "OFF") .. ")"
	targetPlayer = camLockEnabled and getClosestPlayer() or nil
	highlight.Adornee = targetPlayer and targetPlayer.Character or nil
end

-- Toggle Legit
local function toggleLegit()
	legitMode = not legitMode
	legitBtn.Text = "Toggle Legit Mode (" .. (legitMode and "ON" or "OFF") .. ")"
	smoothness = legitMode and 0.05 or 0.1
	predictionAmount = legitMode and Vector3.new(0.02, 0, 0.02) or Vector3.new(0.1, 0, 0.1)
end

-- Listeners
toggleBtn.MouseButton1Click:Connect(function() clickSound:Play() toggleCamlock() end)
legitBtn.MouseButton1Click:Connect(function() clickSound:Play() toggleLegit() end)

keyBtn.MouseButton1Click:Connect(function()
	clickSound:Play()
	waitingForKey = true
	keyBtn.Text = "Press a key..."
end)

UserInputService.InputBegan:Connect(function(input, gpe)
	if gpe then return end
	if waitingForKey and input.KeyCode ~= Enum.KeyCode.Unknown then
		camLockKey = input.KeyCode
		keybindLabel.Text = "Keybind: " .. camLockKey.Name
		keyBtn.Text = "Click to change key"
		waitingForKey = false
	else
		if input.KeyCode == camLockKey then toggleCamlock() end
	end
end)

smoothSlider.MouseButton1Down:Connect(function()
	clickSound:Play()
	local conn
	conn = RunService.RenderStepped:Connect(function()
		local mouse = UserInputService:GetMouseLocation().X
		local sliderPos = smoothSlider.AbsolutePosition.X
		local sliderSize = smoothSlider.AbsoluteSize.X
		local percent = math.clamp((mouse - sliderPos) / sliderSize, 0, 1)
		smoothness = math.clamp(percent, 0.01, 1)
		fill.Size = UDim2.new(percent, 0, 1, 0)
		smoothLabel.Text = ("Smoothness: %.2f"):format(smoothness)
	end)
	UserInputService.InputEnded:Wait()
	if conn then conn:Disconnect() end
end)

-- RenderStep: Smooth Camlock
RunService.RenderStepped:Connect(function()
	if camLockEnabled and targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
		local hrp = targetPlayer.Character.HumanoidRootPart
		local predicted = hrp.Position + (hrp.Velocity * predictionAmount)
		local camPos = camera.CFrame.Position
		local lookDir = (predicted - camPos).Unit
		local blend = camera.CFrame.LookVector:Lerp(lookDir, smoothness)
		camera.CFrame = CFrame.new(camPos, camPos + blend)
	end
end)
